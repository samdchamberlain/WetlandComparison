---
title: "Supplemental Materials"
author: Samuel D Chamberlain^1^, Tyler Anthony^1^, Whendee L Silver^1^, Elke Eichelmann^1^,
  Kyle S Hemes^1^, Patricia Y Oikawa^2^, Cove Sturtevant^3^, Sara H Knox^4^, Jaclyn
  Hatala Matthes^5^, Daphne J Szutu^1^, Joseph G Verfaillie^1^, Dennis D Baldocchi^1^
date: '`r Sys.Date()`'
output:
  pdf_document: default
---

```{r setup, include=FALSE}
#setwd to main package directory
knitr::opts_knit$set(root.dir = normalizePath("../"))
options(digits=2)

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>")

knitr::opts_chunk$set(echo = FALSE, warning=FALSE)
```

```{r packages, message=FALSE}
library(knitr)
library(tidyverse)
library(lubridate)
library(gridExtra)
library(scales)
library(zoo)
```

```{r figS1, fig.height = 8, fig.width = 7, fig.cap="Diel patterns of mean (a) methane flux (*F~CH4~*), (b) net ecosystem exchange (*NEE*), and (c) evapotranspiration (*ET*) by year."}
source("R/Diel_patterns.R") #process the data

a <- ggplot(diel_all, aes(x=time, y=CH4, color=factor(year))) +
  geom_line(size=0.5) + facet_grid(.~site) +
  ylab(expression(F[CH4]~" ("~nmol~m^{-2}~s^{-1}~")")) +
  xlab("Time of day (hr)") + labs(color='Year')  +
  theme_bw() +
  theme(panel.grid.minor = element_blank(), panel.grid.major.y = element_blank())

b <- ggplot(diel_all, aes(x=time, y=NEE, color=factor(year))) +
  geom_line(size=0.5) + facet_grid(.~site) +
  ylab(expression(NEE~" ("~mu~mol~m^{-2}~s^{-1}~")")) +
  xlab("Time of day (hr)") + labs(color='Year')  +
  theme_bw() +
  theme(panel.grid.minor = element_blank(), panel.grid.major.y = element_blank())

c <- ggplot(diel_all, aes(x=time, y=ET, color=factor(year))) +
  geom_line(size=0.5) + facet_grid(.~site) +
  ylab(expression(ET~" ("~mmol~m^{-2}~s^{-1}~")")) +
  xlab("Time of day (hr)") + labs(color='Year')  +
  theme_bw() +
  theme(panel.grid.minor = element_blank(), panel.grid.major.y = element_blank())

#Multiple plots aligned
iA <- ggplotGrob(a)
iB <- ggplotGrob(b)
iC <- ggplotGrob(c)

maxWidth = grid::unit.pmax(iA$widths[2:5], iB$widths[2:5], iC$widths[2:5])
iA$widths[2:5] <- as.list(maxWidth); iB$widths[2:5] <- as.list(maxWidth); iC$widths[2:5] <- as.list(maxWidth);

grid.arrange(a, b, c, ncol=1)
```

```{r figS2, fig.height = 3, fig.width = 4, fig.cap="Mean methane flux (*F~CH4~*) and atmospheric pressure across all half-hourly periods in the 2015 growing season (DOY 100-300). Color scale on each dot denotes the time of day for each paired datapoint. Peak *F~CH4~* occurs late in the afternoon during atmopsheric pressure lows, and this relationship displays notable hysteresis."}
ggplot(data=subset(diel_all, site == "Alluvium" & year == 2015), aes(x=PA, y=CH4, color=time)) +
  geom_point(size=1.5) +
  xlab("Atmospheric pressure (kPA)") +
  ylab(expression(F[CH4]~" ("~nmol~m^{-2}~s^{-1}~")")) +
  theme_bw()


```
